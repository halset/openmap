<?xml version="1.0"?>
<project name="OpenMap" default="all" basedir=".">

  <target name="init" 
          description="Sets properties needed by the other targets.">
    <tstamp/>
    <property name="build.compiler" value="classic"/>

    <property name="openmap.home" value="."/>
    <property name="batik.home" value="/usr/local/java/batik-1.1.1"/>
    <property name="visibroker.home" value="/usr/local/java/vbroker"/>

    <property name="openmap.contrib" value="${openmap.home}/contrib"/>
    <property name="javac.excludes" value="**/*.in, **/Makefile, **/*.bat,
					   **/ChangeLog, **/*.html, **/*.txt,
					   **/*.*.txt, **/*.dat,
					   **/*.pl, **/unimplemented/**, 
					   **/GeneratorTester.java" />
    <property name="jar.excludes" value="${javac.excludes}, **/*.java"/>
    <property name="corba.excludes" value="**/corba/**, **/corbaImage/**, **/CSpecialist/**, **/specialist/**"/>
    <property name="svg.excludes" value="**/SVGFormatter.java"/>
    <property name="j3d.excludes" value="**/j3d/**, **/pilot/**"/>

    <property name="personal.excludes" value="**/gml/**,
    **/OMShape.java, **/OMTextLoader.java, **/EditableOMText.java,
    **/CloudImagePlugIn.java, **/tools/terrain/ProfileGenerator.java"/>

    <property name="svg.jars" value="${batik.home}/lib/batik-svggen.jar;${batik.home}/lib/batik-awt-util.jar;${batik.home}/lib/batik-util.jar;${batik.home}/lib/batik-dom.jar;${batik.home}/lib/batik-ext.jar;${batik.home}/lib/batik-xml.jar;;${batik.home}/lib/batik-svggen.jar;${batik.home}/lib/batik-awt-util.jar;${batik.home}/lib/batik-util.jar;${batik.home}/lib/batik-dom.jar;${batik.home}/lib/batik-ext.jar;${batik.home}/lib/batik-xml.jar;${batik.home}/lib/batik-svg-dom.jar"/>
    <property name="visibroker.jars" value="${visibroker.home}/lib/vbjapp.jar:${visibroker.home}/lib/vbjcosnm.jar:${visibroker.home}/lib/vbjtools.jar:${visibroker.home}/lib/vbjorb.jar"/>

    <!-- These are packages that depend on other, non-standard java
	installations. You can remove these packages from this list if you
	have the packages installed.  -->
    <property name="dependency.excludes" value="${corba.excludes},
	${svg.excludes}, ${j3d.excludes}, ${personal.excludes}"/>

    <uptodate property="openmapBuild.notRequired"
              targetfile="${openmap.home}/lib/openmap.jar" >
       <srcfiles dir= "${openmap.home}/com"
                 excludes="${javac.excludes}, ${dependency.excludes}"
		 includes="**/*.java, **/*.class" />
    </uptodate>

    <uptodate property="contribBuild.notRequired"
              targetfile="${openmap.home}/lib/omcontrib.jar" >
       <srcfiles dir= "${openmap.home}/contrib"
                 excludes="${javac.excludes}, ${dependency.excludes}"
		 includes="**/*.java, **/*.class" />
    </uptodate>
  </target>

  <target name="all" 
          depends="jars" 
          description="Compiles classes and builds jar files in lib directory."/>

  <target name="jars"
          depends="contrib, openmap"
	  description="Builds jar files, placing them in the lib directory."
	  unless="contribBuild.buildRequired, openmapBuild.buildRequired">
    <jar jarfile="${openmap.home}/lib/omcontrib.jar"
         basedir="${openmap.home}/contrib" includes="**/*.class"/>

    <jar jarfile="${openmap.home}/lib/openmap.jar" 
         basedir="${openmap.home}"
	 includes="openmap.properties, com/**/*.class, com/**/*.gif"/>

    <jar jarfile="${openmap.home}/lib/omcore.jar"
         basedir="${openmap.home}"
         includes="openmap.properties,
	           com/bbn/openmap/*.class,	
                   com/bbn/openmap/*.gif,	
                   com/bbn/openmap/event/*.class,
                   com/bbn/openmap/gui/*.class, 
                   com/bbn/openmap/gui/*.gif, 
                   com/bbn/openmap/omGraphics/*.class, 
                   com/bbn/openmap/omGraphics/*.gif, 
                   com/bbn/openmap/omGraphics/editable/*.class, 
                   com/bbn/openmap/omGraphics/event*.class, 
                   com/bbn/openmap/omGraphics/geom/*.class, 
                   com/bbn/openmap/omGraphics/grid/*.class, 
                   com/bbn/openmap/omGraphics/labeled/*.class, 
                   com/bbn/openmap/omGraphics/util/*.class, 
		   com/bbn/openmap/layer/util/*.class,
		   com/bbn/openmap/layer/util/cacheHandler/*.class,
		   com/bbn/openmap/layer/util/html/*.class,
		   com/bbn/openmap/layer/util/http/*.class,
		   com/bbn/openmap/layer/util/stateMachine/*.class,
                   com/bbn/openmap/plugin/*.class, 
                   com/bbn/openmap/proj/*.class, 
                   com/bbn/openmap/tools/drawing/*.class, 
                   com/bbn/openmap/tools/drawing/*.gif, 
                   com/bbn/openmap/util/*.class, 
                   com/bbn/openmap/util/quadtree/*.class, 
                   com/bbn/openmap/image/*.class"/>
  </target>    
  
  <!-- contrib relies on OpenMap Debug class - but we need to build it first. -->
  <target name="debug">
    <javac srcdir="${openmap.home}"
           includes="com/bbn/openmap/util/Debug.java"/>
  </target>

  <target name="openmap" 
          depends="contrib"
	  description="Compiles the OpenMap classes.  Contrib classes compiled if needed.">
    <echo message="Building OpenMap classes..."/>
    <javac srcdir="${openmap.home}"
           classpath="${openmap.home}/lib/omcontrib.jar;${openmap.home}/contrib" 
           excludes="${javac.excludes}, ${dependency.excludes}"/>
  </target>

  <target name="contrib" 
          depends="init, debug"
	  description="Compiles the contrib classes that OpenMap needs.">
    <echo message="Building OpenMap contrib classes..."/>
    <javac srcdir="${openmap.contrib}"
           classpath="${openmap.home}/lib/openmap.jar;${openmap.home}"
           excludes="${javac.excludes}, ${dependency.excludes}"/>
  </target>

  <target name="presvg" 
          depends="init"
	  description="Compiles the SVG Formatter.">
    <echo message="Compiling SVG classes with ${svg.jars}"/>
    <javac srcdir="${openmap.home}"
           includes="${svg.excludes}"
           classpath="${openmap.home}/lib/openmap.jar;${openmap.home};${svg.jars}"
           excludes="${javac.excludes}, ${dependency.excludes}"/>
  </target>

  <target name="svg" 
          depends="init, presvg, jars"
	  description="Compiles the SVG Formatter and recreates the jars
	  after compiling this target.">
    <echo message="SVG classes included in jar files."/>
  </target>

  <!-- TODO - idl compilation for CorbaImage, CSpecialist, CRFPServer -->

  <target name = "idl">
  </target>

  <target name="visibroker"
          depends="init, idl"
	  description="Compiles the Corba classes with the Visibroker CORBA implementation">
     <echo message="Compiling CORBA classes with Visibroker..."/>
     <javac srcdir="${openmap.home}"
	    includes="${corba.excludes}"
	    classpath="${openmap.home/lib/openmap.jar;${openmap.home}/lib/cspec58.jar;${openmap.home}"/>
     <!-- TODO - jar creation rpfserver.jar/specialist.jar -->
   </target>

   <!-- TODO j3d target -->
  <target name="prej3d"
          depends="init"
	  description="Compiles the Java 3D OpenMap code.  You must have the Java 3D extension package (http://java.sun.com/products/java-media/3D/index.html)installed in your Java installation.">
    <javac srcdir="${openmap.home}"
           includes="${j3d.excludes}"
           classpath="${openmap.home}/lib/openmap.jar;${openmap.home}"
           excludes="${javac.excludes}"/>
  </target>

  <target name="j3d"
          depends="init, prej3d, jars"
	  description="Compiles the Java 3D OpenMap code and adds it
  to the jars.  You must have the Java 3D extension package (http://java.sun.com/products/java-media/3D/index.html)installed in your Java installation.">
    <echo message="J3D classes included in jar files."/>
  </target>
 
  <target name="docs" 
          depends="init"
	  description="Make the javadoc API html documents.">
    <javadoc sourcepath="${openmap.home}"
             destdir="${openmap.home}/doc"
             packagenames="com.bbn.openmap.*"
             author="true"
             version="true"
             use="true"
             windowtitle="OpenMap API"
             doctitle="OpenMap"
             bottom="Copyright (C) 2002, BBNT Solutions LLC; See http://openmap.bbn.com/ for details"
    />
  </target>
  
  <target name="clean" 
          depends="clean_classes, clean_contrib, clean_jars"
	  description="Delete jar files and all class files"/>

  <target name="clean_all"
          depends="clean, clean_docs"
	  description="Delete jar files, class files, and generated documentation."/>

  <target name="distclean"
          depends="clean_classes, clean_contrib"
	  description="Delete class files, but not the jar files."/>

  <target name="clean_classes" 
          depends="init"
	  description="Delete the OpenMap class files.">
    <delete>
      <fileset dir="com/bbn/openmap" includes="**/*.class" />
    </delete>
  </target>

  <target name="clean_contrib" 
          depends="init"
	  description="Delete only the class files in the contrib directory.">
    <delete>
      <fileset dir="contrib" includes="**/*.class" />
    </delete>
  </target>

  <target name="clean_jars"
          description="Delete only the jar files from the lib directory.">
    <delete file="lib/omcontrib.jar"/>
    <delete file="lib/omcore.jar"/>
    <delete file="lib/openmap.jar"/>
  </target>

  <target name="clean_docs"
          description="Delete only the generated API documentation.">
    <delete dir="doc/com"/>
    <delete>
      <fileset dir="doc" includes="**/*.html"/>
    </delete>
    <delete file="doc/stylesheet.css"/>
    <delete file="doc/package-list"/>
  </target>

<!--      depends="jars" -->
  <target name="run"
	  description="Run the OpenMap application.">
    <java classname="com.bbn.openmap.app.OpenMap"
          classpath="lib/openmap.jar:lib/omcontrib.jar"
	  fork="yes"/>

  </target>

</project>

