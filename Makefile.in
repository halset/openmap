# **********************************************************************
# 
#    Use, duplication, or disclosure by the Government is subject to
# 	     restricted rights as set forth in the DFARS.
#  
# 			   BBNT Solutions LLC
# 			      A Part of  
# 			         GTE      
# 			  10 Moulton Street
# 			 Cambridge, MA 02138
# 			    (617) 873-3000
#  
# 	  Copyright 1998-2000 by BBNT Solutions LLC,
# 		A part of GTE, all rights reserved.
#  
# **********************************************************************
# $Source: /cvs/distapps/openmap/Attic/Makefile.in,v $
# $Revision: 1.50 $  $Date: 2001/04/25 17:25:03 $
# **********************************************************************


TOP = @top_srcdir@

############
# includes #
############
include ${TOP}/openmap.mk


#####################
# variable settings #
#####################
Core.pkgs =	com.bbn.openmap \
		com.bbn.openmap.event \
		com.bbn.openmap.gui \
		com.bbn.openmap.layer.util \
		com.bbn.openmap.layer.util.cacheHandler \
		com.bbn.openmap.layer.util.html \
		com.bbn.openmap.layer.util.http \
		com.bbn.openmap.layer.util.stateMachine \
		com.bbn.openmap.omGraphics \
		com.bbn.openmap.omGraphics.editable \
		com.bbn.openmap.omGraphics.event \
		com.bbn.openmap.omGraphics.grid \
		com.bbn.openmap.omGraphics.util \
		com.bbn.openmap.plugin \
		com.bbn.openmap.plugin.shis \
		com.bbn.openmap.plugin.earthImage \
		com.bbn.openmap.proj \
		com.bbn.openmap.tools.drawing \
		com.bbn.openmap.util \
		com.bbn.openmap.util.quadtree \
		com.bbn.openmap.image

Core.classes =	com/bbn/openmap/*.class \
		com/bbn/openmap/event/*.class \
		com/bbn/openmap/gui/*.class \
		com/bbn/openmap/layer/util/*.class \
		com/bbn/openmap/layer/util/cacheHandler/*.class \
		com/bbn/openmap/layer/util/html/*.class \
		com/bbn/openmap/layer/util/http/*.class \
		com/bbn/openmap/layer/util/stateMachine/*.class \
		com/bbn/openmap/omGraphics/*.class \
		com/bbn/openmap/omGraphics/editable/*.class \
		com/bbn/openmap/omGraphics/event/*.class \
		com/bbn/openmap/omGraphics/grid/*.class \
		com/bbn/openmap/omGraphics/util/*.class \
		com/bbn/openmap/plugin/*.class \
		com/bbn/openmap/plugin/*.class \
		com/bbn/openmap/plugin/shis/*.class \
		com/bbn/openmap/plugin/earthImage/*.class \
		com/bbn/openmap/proj/*.class \
		com/bbn/openmap/tools/drawing/*.class \
		com/bbn/openmap/util/*.class \
		com/bbn/openmap/util/quadtree/*.class \
		com/bbn/openmap/image/*.class

Core.extra =	com/bbn/openmap/*.gif \
		com/bbn/openmap/gui/*.gif

Core.jar =	${Core.classes} ${Core.extra}

Layer.pkgs =	com.bbn.openmap.layer \
		com.bbn.openmap.layer.dted \
		com.bbn.openmap.layer.nitf \
		com.bbn.openmap.layer.plotLayer \
		com.bbn.openmap.layer.shape \
		com.bbn.openmap.layer.shape.areas \
		com.bbn.openmap.layer.rpf \
		com.bbn.openmap.layer.vpf \
		com.bbn.openmap.layer.daynight \
		com.bbn.openmap.layer.test \
		com.bbn.openmap.layer.link \
		com.bbn.openmap.layer.link.amp \
		com.bbn.openmap.layer.link.shape \
		com.bbn.openmap.layer.location \
		com.bbn.openmap.layer.location.csv \
		com.bbn.openmap.layer.location.db \
		com.bbn.openmap.layer.mif \
		com.bbn.openmap.layer.nexrad \
		com.bbn.openmap.layer.terrain \
		com.bbn.openmap.layer.etopo


Layer.classes =	com/bbn/openmap/layer/*.class \
		com/bbn/openmap/layer/dted/*.class \
		com/bbn/openmap/layer/nitf/*.class \
		com/bbn/openmap/layer/plotLayer/*.class \
		com/bbn/openmap/layer/shape/*.class \
		com/bbn/openmap/layer/shape/areas/*.class \
		com/bbn/openmap/layer/rpf/*.class \
		com/bbn/openmap/layer/vpf/*.class \
		com/bbn/openmap/layer/daynight/*.class \
		com/bbn/openmap/layer/test/*.class \
		com/bbn/openmap/layer/link/*.class \
		com/bbn/openmap/layer/link/amp/*.class \
		com/bbn/openmap/layer/link/shape/*.class \
		com/bbn/openmap/layer/location/*.class \
		com/bbn/openmap/layer/location/csv/*.class \
		com/bbn/openmap/layer/location/db/*.class \
		com/bbn/openmap/layer/mif/*.class \
		com/bbn/openmap/layer/nexrad/*.class \
		com/bbn/openmap/layer/terrain/*.class \
		com/bbn/openmap/layer/etopo/*.class


Layer.props =   com/bbn/openmap/layer/vpf/*.properties

Layer.jar =	${Layer.classes} ${Layer.props}

App.pkgs = 	com.bbn.openmap.app

App.props = 	com/bbn/openmap/openmap.properties

App.classes = 	com/bbn/openmap/app/*.class

App.jar = 	${App.classes} ${App.props}

Example.jar =	com/bbn/openmap/examples/hello/*.class \
		com/bbn/openmap/examples/hello/*.properties

Contrib.jar =	Acme/*.class \
		Acme/JPM/Encoders/*.class

#########
# rules #
#########

default:	@DEFAULT_TARGET@

# java compile OpenMap code
core: omcore

omcore:
	cd com && $(MAKE) all

contrib::
	$(RM) lib/omcontrib.jar

contrib:: lib/omcontrib.jar

jar::
	$(RM) lib/omcore.jar lib/openmap.jar

jar:: 	omcore lib/omcore.jar lib/openmap.jar

all:	omcore jar contrib

clean distclean::
	cd com && $(MAKE) $@

# NOTE: distclean should NOT remove documentation or JAR files.  Our
# autobuild script depends on this.
distclean::
	$(RM) Makefile openmap.mk bin/openmap
	$(RM) config.cache config.log config.status

lib:
	${INSTALL.dir} $@

lib/openmap.jar:: omcore lib
	${JAR} cf $@ ${Core.jar} ${Layer.jar} ${App.jar} ${Example.jar}

lib/omcore.jar:: omcore lib
	${JAR} cf $@ ${Core.jar}

lib/omcontrib.jar:
	cd contrib && $(JAR) cf ../$@ ${Contrib.jar}

GNUmakefile:
	perl rename.pl gmakefile GNUmakefile

gmakefile:
	perl rename.pl GNUmakefile gmakefile

#################
# documentation #
#################

JAVADOC.dir = doc/api

# Removed the -1.1 flag, since our documentation has now been updated
# to reflect the hierarchical javadoc file layout.
JAVA2_DOC_ARGS = 

docs::
	${RM} ${JAVADOC.dir}/*.html

docs:: javadocs

${JAVADOC.dir}:
	${INSTALL.dir} $@

javadocs:	${JAVADOC.dir}
	${JAVADOC} @JAVA2_DOC_ARGS@ -J-mx48m -version -d ${JAVADOC.dir} \
		${Core.pkgs} ${App.pkgs} ${Layer.pkgs}

################
# installation #
################

docdir = ${prefix}/doc

# target to create any of the needed install directories

${prefix} ${bindir} ${libdir} ${datadir}:
	${INSTALL.dir} $@

# build the software before we try to do any installing
install::	all

# install in main dir
install::	${prefix}
	${RM} ${prefix}/README
	${RM} ${prefix}/LICENSE
	${RM} ${prefix}/AUTHORS
	${INSTALL.doc} README ${prefix}
	${INSTALL.doc} LICENSE ${prefix}
	${INSTALL.doc} AUTHORS ${prefix}

# install in bin
install::	${bindir} bin/openmap
	${RM} ${bindir}/openmap
	${INSTALL.bin} bin/openmap ${bindir}/openmap
	${INSTALL.bin} com/bbn/openmap/examples/hello/hello-world ${bindir}/hello-world
	${INSTALL.bin} com/bbn/openmap/examples/simple/simple ${bindir}/simple
	${INSTALL.bin} com/bbn/openmap/examples/simple/simple2 ${bindir}/simple2

# install in lib
install::	${libdir} lib/omcore.jar lib/openmap.jar
	${RM} ${libdir}/omcore.jar ${libdir}/openmap.jar
	${INSTALL.jar} lib/omcore.jar ${libdir}/omcore.jar
	${INSTALL.jar} lib/openmap.jar ${libdir}/openmap.jar

# install in share.  (this must be done one file at a time for
# install-sh to work properly)
install::	${datadir}
	${INSTALL.data} share/openmap.properties ${datadir}
	${INSTALL.data} share/dcwpo-browse.shp ${datadir}
	${INSTALL.data} share/dcwpo-browse.ssx ${datadir}

# install in doc
install-docs::
	@if [ -d ${docdir}.old ]; then ${RM} -r ${docdir}.old ; fi
	@if [ -d ${docdir} ]; then \
		echo "moving existing ${docdir} to ${docdir}.old" ; \
		mv ${docdir} ${docdir}.old ; \
	fi

install-docs::
	cp -R doc ${prefix}
